name: Smart Bid Monitor

on:
  schedule:
    # Run every 15 minutes to catch when campaigns drop below 95% completion
    - cron: '*/15 * * * *'  # Every 15 minutes
  workflow_dispatch: # Allow manual trigger

jobs:
  run-bid-monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 10  # Prevent long runs
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 pytz

    - name: Download cookies from previous run
      uses: actions/download-artifact@v4
      with:
        name: session-cookies
        path: ./
      continue-on-error: true

    - name: Run smart bid monitor (only checks campaigns under 95% completion)
      env:
        USERNAME: ${{ secrets.USERNAME }}
        PASSWORD: ${{ secrets.PASSWORD }}
      run: |
        echo "Starting smart bid monitor..."
        python dynamic_bid_monitor.py
        echo "Smart bid monitor completed. Only active campaigns under 95% completion are monitored."

    - name: Save cookies for next run
      uses: actions/upload-artifact@v3
      if: success()
      with:
        name: session-cookies
        path: session_cookies.pkl
        retention-days: 1
