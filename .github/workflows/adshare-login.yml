name: Generate AdShare Session Cookies

on:
  workflow_dispatch:
    inputs:
      username:
        description: 'AdShare Username/Email'
        required: true
        type: string
      password:
        description: 'AdShare Password'
        required: true
        type: string

jobs:
  login-and-save-cookies:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4
    
    - name: Run login script
      env:
        ADSHARE_USERNAME: ${{ inputs.username }}
        ADSHARE_PASSWORD: ${{ inputs.password }}
      run: |
        echo "Running AdShare login script..."
        python adshare_login.py "$ADSHARE_USERNAME" "$ADSHARE_PASSWORD"
    
    - name: Check for cookies file
      id: check-cookies
      run: |
        if [ -f "session_cookies.pkl" ]; then
          echo "Cookies file found!"
          echo "exists=true" >> $GITHUB_OUTPUT
        else
          echo "ERROR: No cookies file generated!"
          echo "exists=false" >> $GITHUB_OUTPUT
        fi
    
    - name: Upload cookies artifact
      if: steps.check-cookies.outputs.exists == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: adshare-cookies
        path: session_cookies.pkl
        retention-days: 1
    
    - name: Cleanup sensitive files
      if: always()
      run: |
        rm -f session_cookies.pkl
